# J-Melo：日语学习助手

## 项目简介
[J-Melo] 是一个专为日语学习者设计的沉浸式学习平台。它通过结合音乐、歌词编辑、AI辅助工具和词汇管理系统，旨在提供一个多功能、引人入胜的日语学习体验。
该项目全部使用gemini cli编写。

## 项目目的
本项目旨在解决日语学习过程中，尤其是通过音乐学习时，歌词理解、生词记忆和发音校正等方面的痛点。我们致力于提供一个高度可定制和互动，且结合了最前沿AI技术和语言学习理论的学习环境，帮助用户更高效、更愉快地提升日语水平。

## 主要功能
J-Melo 提供以下核心功能：

*   **沉浸式播放器**：
    *   加载视频/音频内容，支持网络url（YouTube,bilibili，网易云）。
    *   歌词与播放进度同步高亮显示，支持音节级别精准定位。
    *   可切换平假名注音和中文翻译的显示。
    *   在歌词面板上单击背景可切换播放/暂停（移动端友好）。
    *   黑胶唱片风格的旋转封面，提升视觉体验。
*   **智能歌词系统**：
    *   **歌词时间轴编辑器**：直观的视觉界面，支持精细调整歌词的开始和结束时间，包括单词级别的拖拽和时间轴编辑。
    *   **完整歌词JSON编辑器**：提供高级用户直接编辑和验证歌词的原始JSON结构，支持实时预览和错误检查。
    *   **AI歌词校正**：利用LLM智能修复不准确的歌词时间轴，支持自定义Prompt模板和预览修正结果，确保歌词与音频完美同步。
    *   **AI歌词翻译**：支持两种灵活的翻译模式：
        *   **翻译当前歌词**：通过LLM翻译当前歌曲的日语歌词为目标语言，并智能映射到原有歌词的时间轴上。
        *   **映射提供的翻译**：允许用户输入已有的翻译文本，LLM会将其智能地映射到现有歌词的时间轴上，方便整合外部翻译资源。
        *   提供翻译预览和保存功能，支持在设置中选择目标翻译语言。
*   **AI导师与词汇管理**：
    *   **AI单词解释**：选中歌词中的单词，利用LLM获取详细解释（例如，词义、用法、例句等），支持自定义Prompt模板和结果预览，并将解释直接保存为词汇卡片。
    *   **词汇卡片管理**：
        *   提供多种显示模式：查看所有词汇、按歌曲分组查看或通过搜索查找特定词汇。
        *   支持多选批量删除和导出Anki兼容的CSV格式（包含歌曲名标签），方便与其他学习工具集成。
        *   **间隔重复系统 (SRS) 复习模式**：根据单词的熟练度（通过每次复习后的反馈调整）智能安排复习，确保用户在遗忘曲线的关键点进行复习，从而高效记忆。
*   **移动端响应式设计**：
    *   全面优化移动设备用户体验，支持在播放器、歌词和工具面板之间通过滑动进行导航。
    *   所有面板和功能均能自适应不同尺寸的屏幕，提供流畅、一致的用户体验。
*   **多语言支持**：
    *   应用界面支持中文和英文切换，未来可轻松扩展更多语言。
*   **可定制的后端服务**：
    *   在应用设置中可灵活配置后端API地址，方便部署者根据自己的服务器环境进行调整。

## 如何部署

J-Melo 项目分为前端（`app` 目录）和后端（`backend` 目录）两部分。请确保两者都能正确运行以获得完整功能。

### **1. 后端部署**

后端是一个基于 Python 的 FastAPI 应用，负责处理媒体抓取、音频转录和图像代理等任务。

**先决条件:**

*   Python 3.8+
*   `ffmpeg`：用于处理音频/视频文件。请确保其已安装并可在系统路径中访问。
*   `yt-dlp`：用于从各种平台下载媒体。后端会自动安装到其虚拟环境中。
*   `WhisperX`：用于音频转录。后端会自动安装到其虚拟环境中。

**部署步骤:**

1.  **克隆仓库:**
    ```bash
    git clone https://github.com/your-username/J-Melo.git
    cd J-Melo/backend
    ```
    _请将 `your-username` 替换为实际的 GitHub 用户名或组织名。_
2.  **创建并激活虚拟环境:**
    ```bash
    python -m venv venv
    # 在 Windows 系统上:
    .\venv\Scripts\activate
    # 在 macOS/Linux 系统上:
    source venv/bin/activate
    ```
3.  **安装依赖:**
    ```bash
    pip install -r requirements.txt
    ```
    *   _注意: `yt-dlp` 和 `WhisperX` 及其依赖可能会花费一些时间安装。_
4.  **启动后端服务:**
    ```bash
    uvicorn main:app --reload --host 0.0.0.0 --port 8000
    ```
    默认情况下，后端将在 `http://0.0.0.0:8000` 上运行。`--reload` 标志在开发过程中非常有用，生产环境可移除。

### **2. 前端部署**

前端是一个基于 Next.js、React 和 TypeScript 的应用程序。

**先决条件:**

*   Node.js (LTS 版本推荐)
*   npm 或 yarn

**部署步骤:**

1.  **进入前端目录:**
    ```bash
    cd ../app
    ```
2.  **安装依赖:**
    ```bash
    npm install # 或者 yarn install
    ```
3.  **配置后端地址 (可选，推荐):**
    *   在 `app/public/` 目录下，您会找到一个 `config.json.example` 文件。请复制它并重命名为 `config.json`。
    *   在此 `config.json` 文件中，您可以指定您的后端服务地址。例如：
        ```json
        {
          "backendUrl": "http://localhost:8000"
        }
        ```
        如果您不创建此文件，前端将默认尝试连接到 `http://localhost:8000`。您也可以在应用内的设置面板中修改此地址。
        注意，若你将服务器在公网进行了部署，那么这个后端地址也应该能被公网访问，此时就不能是 `localhost` 了。
4.  **启动开发服务器:**
    ```bash
    npm run dev # 或者 yarn dev
    ```
    开发服务器将在 `http://localhost:3000` 上运行。
5.  **构建生产版本:**
    ```bash
    npm run build # 或者 yarn build
    npm start     # 或者 yarn start (启动生产服务器)
    ```
    在生产环境中，您可能需要配置环境变量或使用 Docker 来管理后端地址。

### **3. Docker 部署 (可选，仅限后端)**

如果您熟悉 Docker，可以使用提供的 `Dockerfile` 部署后端服务。

1.  **进入后端目录:**
    ```bash
    cd J-Melo/backend
    ```
2.  **构建 Docker 镜像:**
    ```bash
    docker build -t jmelo-backend .
    ```
3.  **运行 Docker 容器:**
    ```bash
    docker run -p 8000:8000 jmelo-backend
    ```
    后端服务将在容器的 8000 端口运行，并映射到主机的 8000 端口。

---